define(["app/splunk_app_aws/js/libs/jquery","app/splunk_app_aws/js/libs/underscore","app/splunk_app_aws/js/swc-aws/index_for_visualization","splunkjs/mvc","app/splunk_app_aws/js/libs/backbone"],function(t,e,i,n,a){return function(t){function e(n){if(i[n])return i[n].exports;var a=i[n]={exports:{},id:n,loaded:!1};return t[n].call(a.exports,a,a.exports,e),a.loaded=!0,a.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){var n,a;i.p=function(){function t(){for(var t,i,n="",a=0,s=arguments.length;a<s;a++)t=arguments[a].toString(),i=t.length,i>1&&"/"==t.charAt(i-1)&&(t=t.substring(0,i-1)),n+="/"!=t.charAt(0)?"/"+t:t;if("/"!=n){var o=n.split("/"),r=o[1];if("static"==r||"modules"==r){var l=n.substring(r.length+2,n.length);n="/"+r,window.$C.BUILD_NUMBER&&(n+="/@"+window.$C.BUILD_NUMBER),window.$C.BUILD_PUSH_NUMBER&&(n+="."+window.$C.BUILD_PUSH_NUMBER),"app"==o[2]&&(n+=":"+e("APP_BUILD",0)),n+="/"+l}}var h=e("MRSPARKLE_ROOT_PATH","/"),c=e("DJANGO_ROOT_PATH",""),d=e("LOCALE","en-US"),u="";return u=c&&n.substring(0,c.length)===c?n.replace(c,c+"/"+d.toLowerCase()):"/"+d+n,""==h||"/"==h?u:h+u}function e(t,e){if(window.$C&&window.$C.hasOwnProperty(t))return window.$C[t];if(void 0!==e)return e;throw new Error("getConfigValue - "+t+" not set, no default provided")}return t("/static/app/splunk_app_aws")+"/"}(),n=[i(1),i(2),i(3),i(4),i(9),i(12),i(5),i(8)],a=function(t,e,i,n,a,s,o,r){for(var l=i.SplunkVisualizationBase,h={},c=window.location.search.replace(/^\?/,"").split("&"),d=c.length,u=0;u<d;u++)if(!e.isEmpty(c[u])){var p=c[u].split("=");h[p[0]]=p[1]}return l.extend({initialize:function(){this.$el=t(this.el),this.$el.html('<a id="schedule_job_button" class="btn" style="margin-right:10px; float:right">Schedule job</a><div id="anomaly_chart"></div>'),this.dataHelper=new n},getInitialDataParams:function(){return{outputMode:l.COLUMN_MAJOR_OUTPUT_MODE,count:1e3}},setupView:function(){this.chartView=new a({el:t("#anomaly_chart")}).render(),this.managerDialog=new s,this.managerDialog.render().appendTo(t("body")),t("#schedule_job_button:not(disabled)").click(function(){this.managerDialog.fetchJobs()}.bind(this))},formatData:function(i,n){if(i.columns.length<1||i.columns[0].length<1)return{};if(!i.meta.done)return{};try{this.dataHelper.isFieldValid(i.fields)}catch(t){throw new l.VisualizationError(t)}var a={},s=r.HIGHLIGHT_MODE;if((e.isEmpty(h.time)||e.isEmpty(h.field))&&(s=this.dataHelper.getMode(i.fields)),t("#schedule_job_button").removeClass("disabled"),s===r.HIGHLIGHT_MODE){t("#schedule_job_button").addClass("disabled");var o=parseInt(h.time)*r.MILLI_SEC_IN_SEC;a=this.dataHelper.wrapHighlightResults(i.fields,i.columns,n,this.getPropertyNamespaceInfo().propertyNamespace,o,h.field)}else a=s===r.DETECT_MODE?this.dataHelper.wrapDetectResults(i.fields,i.columns,n,this.getPropertyNamespaceInfo().propertyNamespace):this.dataHelper.wrapDisplayResults(i.fields,i.columns,n,this.getPropertyNamespaceInfo().propertyNamespace);if(e.isEmpty(a.series))throw new l.VisualizationError("This visualization only supports numbers. Please fill null or check type.");return a.mode=s,a},updateView:function(t,i){if(e.isEmpty(t))this.chartView.showLoading();else{var n=this.getPropertyNamespaceInfo().propertyNamespace;this.chartView.hideLoading(),this.chartView.updateParams(i,n),this.chartView.updateSeries(t.series,t.start,t.end,t.span);var a={trainNum:t.trainNum,trainUnit:t.trainUnit};a[r.JOB_SEARCH]=this._events.drilldown[0].context.model.config.get("search"),this.managerDialog.setJobParams(a,t.mode)}}})}.apply(e,n),!(void 0!==a&&(t.exports=a))},function(e,i){e.exports=t},function(t,i){t.exports=e},function(t,e){t.exports=i},function(t,e,i){function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var a,s,o=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}();a=[i(2),i(1),i(5),i(3),i(6),i(8)],s=function(t,e,i,a,s,r){var l=a.SplunkVisualizationBase,h=a.SplunkVisualizationUtils,c=function(){function e(){n(this,e)}return o(e,[{key:"isFieldValid",value:function(t){for(var t=this._getFields(t),e=this._getDetectedFields(t),i=!1,n=!0,a=0;a<e.length;a++){var s=e[a];if(i&&!s.startsWith("outlier_")&&!s.startsWith("value_")){n=!1;break}if((s.startsWith("outlier_")||s.startsWith("value_"))&&(i=!0,s.startsWith("value_"))){var o="outlier_"+s.slice(6);if(e.indexOf(o)<0){n=!1;break}}}if(!n)throw new l.VisualizationError('For non-default detection algorithm, please convert fields name to "value_*", "outlier_*" where "value_*" indicates the value of field and "outlier_*" indicates whether it is outlier.');if(!i&&(t.indexOf("_time")<0||t.indexOf("_span")<0))throw new l.VisualizationError("This visualization requires timestamped, evenly spaced numeric time-series data. Try using the timechart command in your query.");return!0}},{key:"wrapDetectResults",value:function(e,i,n,a){var o={},l=this._wrapPreparation(e,i,o);if(t.isEmpty(l.columns))return o;for(var h=n[a+"strictness"],c=n[a+"type"],d=n[a+"stack_mode"],u=n[a+"mask"],p=s.getInstance(h),m=[],_="true"===u?p.getTrainCount():0,f=0;f<l.fields.length;f++){var E=l.fields[f],b=l.columns[E];t.isUndefined(b)||m.push(this._wrapSeries(b,p.detect(b),_,E,r.NORMAL_COLORS[f%r.NORMAL_COLORS.length],c,d))}o.series=m,o.start+=_*o.span;var O=this._getTrainTime(p,o.span);return o.trainNum=O.num,o.trainUnit=O.unit,o}},{key:"wrapDisplayResults",value:function(e,i,n,a){var s={},o=this._wrapPreparation(e,i,s);if(t.isEmpty(o.columns))return s;for(var l=[],h=n[a+"type"],c=n[a+"stack_mode"],d=0,u=0;u<o.fields.length;u++){var p=o.fields[u];if(!p.startsWith("outlier")&&!p.startsWith("severity")){var m=o.columns[p],_=o.columns["outlier_"+p.slice(6)].reduce(function(t,e,i){return"True"===e&&t.push(i),t},[]);l.push(this._wrapSeries(m,_,0,p.slice(6),r.NORMAL_COLORS[d++%r.NORMAL_COLORS.length],h,c))}}return s.trainNum="0",s.trainUnit="m",s.series=l,s}},{key:"wrapHighlightResults",value:function(e,i,n,a,s,o){var l={},h=this._wrapPreparation(e,i,l);if(t.isEmpty(h.columns))return l;for(var c=[],d=n[a+"type"],u=n[a+"stack_mode"],p=0;p<h.fields.length;p++){var m=h.fields[p];if(!m.startsWith("outlier")&&!m.startsWith("severity")){var _=h.columns[m],f=[];m!==o&&"value_"+o!==m||f.push((s-l.start)/l.span),c.push(this._wrapSeries(_,f,0,m,r.NORMAL_COLORS[p%r.NORMAL_COLORS.length],d,u))}}return l.series=c,l}},{key:"getMode",value:function(t){var t=this._getFields(t),e=this._getDetectedFields(t);return 0===e.length||e[0].startsWith("outlier_")||e[0].startsWith("value_")?r.DISPLAY_MODE:r.DETECT_MODE}},{key:"_getTrainTime",value:function(t,e){var i="s";return e%r.MILLI_SEC_IN_DAY===0?(i="d",e/=r.MILLI_SEC_IN_DAY):e%r.MILLI_SEC_IN_HOUR===0?(i="h",e/=r.MILLI_SEC_IN_HOUR):e%r.MILLI_SEC_IN_MIN===0?(i="m",e/=r.MILLI_SEC_IN_MIN):e/=r.MILLI_SEC_IN_SEC,{num:e*t.getTrainCount(),unit:i}}},{key:"_wrapSeries",value:function(e,i,n,a,s,o,l){t.each(i,function(t){e[t]={y:e[t],color:r.OUTLIER_COLOR,marker:{enabled:!0,symbol:"circle",radius:5}}}),e=e.slice(n);var h={data:e,color:s,name:a,type:o};return"no"!==l&&(h.stacking=l),h}},{key:"_wrapPreparation",value:function(t,e,i){var t=this._getFields(t);i.start=new Date(e[t.indexOf("_time")][0]).getTime(),i.end=new Date(e[t.indexOf("_time")][e[0].length-1]).getTime(),t.indexOf("_span")>=0?i.span=parseInt(e[t.indexOf("_span")][0])*r.MILLI_SEC_IN_SEC:i.span=new Date(e[t.indexOf("_time")][1]).getTime()-i.start;var n=this._getDetectedFields(t),a=this._getData(e,t,n);return{fields:n,columns:a}}},{key:"_getFields",value:function(e){return t.map(e,function(t){var e=t.name;return e.startsWith("values(")&&e.endsWith(")")&&(e=e.slice(7,-1)),e})}},{key:"_getDetectedFields",value:function(e){return t.filter(e,function(t){return"_time"!==t&&"_span"!==t&&"_spandays"!=t&&!t.startsWith("severity_")})}},{key:"_getData",value:function(e,i,n){var a={};return t.each(n,function(n){var s=i.indexOf(n),o=!0,r=!0,l=t.map(e[s],function(e){if("True"===e||"False"===e)return r||(o=!1),e;r=!1;var i=parseInt(h.escapeHtml(e));return t.isNaN(i)&&(o=!1),i});o&&(a[n]=l)}),a}}]),e}();return c}.apply(e,a),!(void 0!==s&&(t.exports=s))},function(t,e){t.exports=n},function(t,e,i){var n,a;n=[i(2),i(1),i(7)],a=function(t,e,i){var n=function(t){this.strictness=t};n.prototype.getStrictness=function(){return this.strictness},n.prototype.getMethod=function(){return"zscore"},n.prototype.getTrainCount=function(){return i.TRAIN_COUNT},n.prototype.detect=function(e){var n=[];if(t.isEmpty(e))return n;if(e.length<i.TRAIN_COUNT)return n;for(var a=i.STRICTNESS_MAP[this.strictness],s=i.TRAIN_COUNT;s<e.length;s++){var o=e.slice(s-i.TRAIN_COUNT,s),r=e[s],l=t.reduce(o,function(t,e){return t+e},0),h=l/i.TRAIN_COUNT,c=Math.pow(t.reduce(o,function(t,e){return t+Math.pow(e-h,2)},0)/i.TRAIN_COUNT,.5);o.sort(function(t,e){return t-e});var d=o[parseInt(i.TRAIN_COUNT/2)];i.TRAIN_COUNT%2==0&&(d+=o[parseInt(i.TRAIN_COUNT/2-1)],d/=2),r>d+a*c&&n.push(s)}return n};var a={};return{getInstance:function(e){return t.isEmpty(a[e])&&(a[e]=new n(e)),a[e]}}}.apply(e,n),!(void 0!==a&&(t.exports=a))},function(t,e,i){var n,a;n=[],a=function(){return{STRICTNESS_MAP:{l:3,m:2,h:1},TRAIN_COUNT:10}}.apply(e,n),!(void 0!==a&&(t.exports=a))},function(t,e,i){var n,a;n=[],a=function(){return{MILLI_SEC_IN_SEC:1e3,MILLI_SEC_IN_MIN:6e4,MILLI_SEC_IN_HOUR:36e5,MILLI_SEC_IN_DAY:864e5,DAY_IN_WEEK:7,DAY_IN_MONTH:30,OUTLIER_COLOR:"#ff0000",NORMAL_COLORS:["#d6563c","#1e93c6","#f2b827","#6a5c9e","#31a35f","#3863a0","#a2cc3e","#ed8440","#cc5068","#73427f","#11a88b","#99712b","#314d5b"],ENABLE_MODE:1,DETECT_MODE:2,DISPLAY_MODE:4,HIGHLIGHT_MODE:8,CREATE_MODE:16,EDIT_MODE:32,INDEX:"summary",SOURCE_TYPE:"aws:anomaly",JOB_ID:"job_id",JOB_NAME:"job_name",JOB_PRIORITY:"job_priority",JOB_MODE:"job_mode",JOB_SCHEDULE:"job_schedule",JOB_SEARCH:"job_search",JOB_TRAIN:"job_train",JOB_TAGS:"job_tags",JOB_ALERT_ID:"job_alert_id",JOB_DESCRIPTION:"job_description",INVALID_SEVERITY_COLOR:"#333",SEVERITY_COLOR_MAP:{1:"#FCE9E5",2:"#fed1c8",3:"#fa8e81",4:"#F14E3B"},UPDATE_SCHEDULE_CHECKER_JOB_SPL:'| inputlookup anomaly_schedule_checker | where job_id!="<%= jobId %>" | outputlookup anomaly_schedule_checker',UPDATE_SCHEDULE_CHECKER_ALERT_SPL:'| inputlookup anomaly_schedule_checker | where job_id!="<%= jobId %>" OR is_alert!="1" | outputlookup anomaly_schedule_checker',DAILY_TIME_FORMAT:"YYYY-MM-DD",HOURLY_TIME_FORMAT:"YYYY-MM-DD HH:mm:ss"}}.apply(e,n),!(void 0!==a&&(t.exports=a))},function(t,e,i){var n,a;n=[i(2),i(1),i(3),i(10),i(8),i(11)],a=function(t,e,i,n,a,s){var o=i.BaseView,r=".highcharts-grid, .highcharts-legend, .highcharts-axis, .highcharts-axis-labels.highcharts-yaxis-labels, .highcharts-axis-labels.highcharts-xaxis-labels, .highcharts-series-group";return o.extend({initialize:function(){o.prototype.initialize.apply(this,arguments),e("#anomaly_chart").length&&(n.chart.renderTo=this.$el[0].id),this.chart=new s.Chart(n)},render:function(){return this.chart.reflow(),this},hideLoading:function(){this.chart.hideLoading(),e(r).attr("display","")},showLoading:function(){this.chart.showLoading("Waiting for data..."),e(r).attr("display","none")},updateParams:function(t,e){var i=t[e+"y_title"];this.ytitle!==i&&this.chart.yAxis[0].setTitle({text:i}),this.ytitle=i,i=t[e+"x_title"],this.xtitle!==i&&this.chart.yAxis[0].setTitle({text:i}),this.xtitle=i},updateSeries:function(i,n,s,o){for(;this.chart.series.length>0;)this.chart.series[0].remove(!1);var r=this;t.each(i,function(t){n===s&&(t.data[0]={y:t.data[0],marker:{enabled:!0,symbol:"square",radius:5}}),r.chart.addSeries(e.extend(t,{pointStart:n,pointInterval:o}),!1)}),n===s&&(s=n+o),o<a.MILLI_SEC_IN_DAY?this.chart.timeformat=a.HOURLY_TIME_FORMAT:this.chart.timeformat=a.DAILY_TIME_FORMAT,this.chart.xAxis[0].update({minRange:o,min:n,max:s},!0)}})}.apply(e,n),!(void 0!==a&&(t.exports=a))},function(t,e,i){var n,a;n=[i(1),i(2),i(3)],a=function(t,e,i){var n=i.moment;return{chart:{animation:!1,height:200},legend:{align:"right",layout:"vertical",verticalAlign:"middle",symbolRadius:0},loading:{labelStyle:{fontWeight:"normal",color:"#a6a6a6",fontSize:"13px"},style:{opacity:1,backgroundColor:"white"}},tooltip:{useHTML:!0,formatter:function(){var t=e.template('<table><tr><td>_time</td><td align="right" width="75%"><%=time %></td></tr><tr><td style="color: <%=color %>"><%=name %></td><td align="right" width="75%"><%=value %></td></tr></table>'),i="YYYY-MM-DD HH:mm:ss";return t({time:n(this.x).format(i),name:this.series.name,color:this.series.color,value:this.y})},backgroundColor:"rgba(0, 0, 0, 0.9)",borderColor:"black",style:{color:"white"}},title:{text:""},yAxis:{title:""},credits:{enabled:!1},xAxis:{title:"",type:"datatime",minRange:1e3,labels:{formatter:function(){return n(this.value).format(this.chart.timeformat)}},tickPositioner:function(){var t=5,e=[],i=this.min,n=Math.ceil((this.max-this.min)/t);if(null!==this.min&&null!==this.max)for(i;i<=this.max;i+=n)e.push(i);return e}},plotOptions:{area:{lineWidth:1},series:{fillOpacity:.75,marker:{enabled:!1,symbol:"square"},point:{events:{mouseOver:function(){var t=this.series,i=this.series.chart.series,n=["group","markerGroup"];e.each(i,function(i){i!==t&&e.each(n,function(t){i[t].animate({opacity:.1},{duration:150})})})},mouseOut:function(){var t=this.series,i=this.series.chart.series,n=["group","markerGroup"];e.each(i,function(i){i!==t&&e.each(n,function(t){i[t].animate({opacity:1},{duration:50})})})}}}}}}}.apply(e,n),!(void 0!==a&&(t.exports=a))},function(t,e,i){var n,a;n=[i(1),i(3)],a=function(t,e){var i=e.HighCharts,n=i.each;return i.wrap(i.Legend.prototype,"renderItem",function(t,e){t.call(this,e);var i=!!e.series,a=i?e.series.points:this.chart.series,s=i?["graphic"]:["group","markerGroup"],o=e.legendGroup.element;o.onmouseover=function(){n(a,function(t){t!==e&&n(s,function(e){t[e].animate({opacity:.1},{duration:150})})})},o.onmouseout=function(){n(a,function(t){t!==e&&n(s,function(e){t[e].animate({opacity:1},{duration:50})})})}}),i}.apply(e,n),!(void 0!==a&&(t.exports=a))},function(t,e,i){var n,a;n=[i(2),i(13),i(3),i(14),i(16),i(20),i(21),i(8)],a=function(t,e,i,n,a,s,o,r){var l=i.BaseView,h=i.AlertModel;i.splunkUtils;return l.extend({initialize:function(){l.prototype.initialize.apply(this,arguments),this.models={},this.children={},this.models.job=new o,this.models.input=new e.Model,this.models.mode=r.DETECT_MODE,this.children.job=new n({models:{input:this.models.input}}),this.children.alert=new s,this.children.info=new a,this.listenTo(this.models.job,"loadFail",function(){this.children.info.showFail("job","load")}.bind(this)),this.listenTo(this.models.job,"loadSuccess",function(){var e=this.models.job.getNameWithSearch(this.models.input.get(r.JOB_SEARCH));this.models.input.set({usedNames:this.models.job.get("usedNames")}),t.isEmpty(e)?this._showCreateJob():this.children.info.showJobEditConfirm(e)}.bind(this)),this.listenTo(this.children.info,"createJob",this._showCreateJob.bind(this)),this.listenTo(this.children.info,"editJob",this._showEditJob.bind(this)),this.listenTo(this.children.info,"createAlert",this._showCreateAlert.bind(this)),this.listenTo(this.children.info,"editAlert",this._showEditAlert.bind(this)),this.listenTo(this.children.job,"saveJob",this._saveJob.bind(this))},fetchJobs:function(){this.models.job.fetchData()},setJobParams:function(t,e){this.models.input.set(t),this.models.mode=e},render:function(){this.$el.append(this.children.info.render()),this.$el.append(this.children.job.render())},_showCreateJob:function(){var t=this.models.mode;this.children.job.show(this.models.job.get("tags"),t|r.CREATE_MODE)},_showEditJob:function(t){var e=this.models.job.getJobWithName(t),i=this.models.mode;this.models.input.set(e),this.children.job.show(this.models.job.get("tags"),i|r.EDIT_MODE)},_saveJob:function(e){var i=r.CREATE_MODE;(e&r.EDIT_MODE)>0&&!t.isEmpty(this.models.input.get(r.JOB_ALERT_ID))&&(i=r.EDIT_MODE);var n=t.pick(this.models.input.toJSON(),r.JOB_NAME,r.JOB_PRIORITY,r.JOB_SCHEDULE,r.JOB_SEARCH,r.JOB_TRAIN,r.JOB_TAGS);(e&r.EDIT_MODE)>0?$.when(this.models.job.updateStanza(this.models.input.get(r.JOB_ID),n)).then(function(){this.children.info.showJobSaveSuccess(e,i)}.bind(this),function(){this.children.info.showFail("job","update")}.bind(this)):(n[r.JOB_MODE]=this.models.mode|r.ENABLE_MODE,$.when(this.models.job.createStanza(n)).then(function(t){this.models.input.set(r.JOB_ID,t),this.children.info.showJobSaveSuccess(e,i)}.bind(this),function(){this.children.info.showFail("job","save")}.bind(this)))},_showCreateAlert:function(){var t=function(){var t=arguments[0],e={};e[r.JOB_ALERT_ID]=t.id,this.models.job.updateStanza(this.models.input.get(r.JOB_ID),e)};this.children.alert.showCreateAlert(this.models.input.get(r.JOB_ID),this.models.input.get(r.JOB_NAME),this.models.input.get(r.JOB_SCHEDULE),this.models.input.get(r.JOB_SEARCH),t,this)},_showEditAlert:function(){var t=new h;t.set("id",this.models.input.get(r.JOB_ALERT_ID)),t.fetch({success:function(e,i){this.children.alert.showEditAlert(t,function(t){},this)}.bind(this),error:function(t,e){this.children.info.showAlertLoadFail(this.models.input.get(r.JOB_NAME))}.bind(this)})}})}.apply(e,n),!(void 0!==a&&(t.exports=a))},function(t,e){t.exports=a},function(t,e,i){var n,a;n=[i(2),i(1),i(13),i(3),i(8),i(15)],a=function(t,e,i,n,a,s){var o=n.Modal,r=n.ControlGroup,l=[],h='<a href="#" class="btn cancel modal-btn-cancel pull-left" data-dismiss="modal">Cancel</a>',c='<a href="#" class="btn btn-primary modal-btn-primary pull-right">Save</a>';return o.extend({initialize:function(t){o.prototype.initialize.apply(this,arguments),this.models=this.options.models,this.mode=a.DETECT_MODE|a.CREATE_MODE;var e={attachDialogTo:".modal:visible",scrollContainer:".modal:visible .modal-body:visible"};this.nameView=new r({controlType:"Text",controlClass:"controls-block",controlOptions:{modelAttribute:a.JOB_NAME,model:this.models.input},label:"Name"}),this.descriptionView=new r({controlType:"Textarea",controlClass:"controls-block",controlOptions:{modelAttribute:a.JOB_DESCRIPTION,model:this.models.input,placeholder:"Optional"},label:"Description"}),this.scheduleView=new r({className:"control-group",controlType:"SyntheticSelect",controlClass:"controls-block",controlOptions:{modelAttribute:a.JOB_SCHEDULE,model:this.models.input,items:[{label:"Run every hour",value:"Hourly"},{label:"Run every day",value:"Daily"},{label:"Run every week",value:"Weekly"},{label:"Run every month",value:"Monthly"}],save:!1,toggleClassName:"btn",labelPosition:"outside",elastic:!0,popdownOptions:e},label:"Schedule"}),this.severityView=new r({className:"control-group",controlType:"SyntheticSelect",controlClass:"controls-block",controlOptions:{modelAttribute:a.JOB_PRIORITY,model:this.models.input,items:[{label:"Low",value:"1"},{label:"Medium",value:"2"},{label:"High",value:"3"},{label:"Critical",value:"4"}],save:!1,toggleClassName:"btn",labelPosition:"outside",elastic:!0,popdownOptions:e},label:"Priority"}),this.containerEl=document.createElement("div"),this.containerEl.setAttribute("id","customselect"),this.containerEl.style.cssText="padding-bottom: 10px;margin-left: 180px; width: 330px;",this.trainNumView=new r({controlType:"Text",controlClass:"controls-block",controlOptions:{modelAttribute:"trainNum",model:this.models.input},label:"Train period",additionalClassNames:"control-train-num"}),this.trainUnitView=new r({className:"control-group",controlType:"SyntheticSelect",controlClass:"controls-block",controlOptions:{modelAttribute:"trainUnit",model:this.models.input,items:[{label:"seconds",value:"s"},{label:"minutes",value:"m"},{label:"hours",value:"h"},{label:"days",value:"d"}],save:!1,toggleClassName:"btn",labelPosition:"outside",elastic:!0,popdownOptions:e}})},events:e.extend({},o.prototype.events,{"click a.modal-btn-primary":function(t){t.preventDefault(),this._validateInput()&&(0==l.length?this.models.input.set(a.JOB_TAGS,""):this.models.input.set(a.JOB_TAGS,l.join(",")),l=[],this.models.input.set(a.JOB_TRAIN,Math.abs(parseInt(this.models.input.get("trainNum")))+this.models.input.get("trainUnit")),this.unmount(),this.hide(),this.trigger("saveJob",this.mode))},"click a.modal-btn-cancel":function(t){this.unmount()}}),handleChangeValueMultiselect:function(t,e){var i=e.values;l=i},_validateInput:function(){var e=!0,i=this.models.input.get(a.JOB_NAME),n=parseInt(this.models.input.get("trainNum"));return t.isEmpty(i)?(this.$(".job-modal-hint").html("Unable to create job with empty name."),e=!1):(this.mode&a.CREATE_MODE)>0&&this.models.input.get("usedNames").indexOf(i)>=0?(this.$(".job-modal-hint").html('Unable to create job with name "'+i+'". A job with that name already exists.'),e=!1):t.isNaN(n)&&(this.$(".job-modal-hint").html("Invalid train period number "+n+" . Integer is required."),e=!1),e},show:function(t,e){this.mode=e;var i=new Set;if(this.models.input.attributes.job_tags)var i=new Set(this.models.input.attributes.job_tags.split(","));if(l=1==i.size&&""==Array.from(i)[0]?[]:Array.from(i),this.unmount=s.createMultiselectComponent(i,t,this.containerEl,this.handleChangeValueMultiselect),(e&a.CREATE_MODE)>0){var n={};n[a.JOB_NAME]="",n[a.JOB_PRIORITY]="1",n[a.JOB_DESCRIPTION]="",n[a.JOB_SCHEDULE]="Hourly",n[a.JOB_TAGS]="",n[a.JOB_ALERT_ID]="",0===(e&a.DETECT_MODE)&&(n.trainNum="0",n.trainUnit="m"),this.models.input.set(n),this.unmount=s.createMultiselectComponent(i,t,this.containerEl,this.handleChangeValueMultiselect)}(e&a.DETECT_MODE)>0&&(this.trainNumView.disable(),this.trainUnitView.disable()),this.$el.modal("show")},render:function(){return this.$el.html(o.TEMPLATE),this.$(o.HEADER_TITLE_SELECTOR).html("Anomaly detection job settings"),this.$(o.FOOTER_SELECTOR).append(h),this.$(o.FOOTER_SELECTOR).append(c),this.$(o.BODY_SELECTOR).append(o.FORM_HORIZONTAL),this.nameView.render().appendTo(this.$(o.BODY_FORM_SELECTOR)),this.descriptionView.render().appendTo(this.$(o.BODY_FORM_SELECTOR)),this.severityView.render().appendTo(this.$(o.BODY_FORM_SELECTOR)),this.scheduleView.render().appendTo(this.$(o.BODY_FORM_SELECTOR)),this.$(o.BODY_FORM_SELECTOR).append('<label class="control-label" for="customselect" id="customlabel">Tags</label>'),this.$(o.BODY_FORM_SELECTOR).append(this.containerEl),this.trainNumView.render().appendTo(this.$(o.BODY_FORM_SELECTOR)),this.trainUnitView.render().appendTo(this.$(o.BODY_FORM_SELECTOR)),this.$(o.BODY_FORM_SELECTOR).append('<p class="job-modal-hint"></p>'),this}})}.apply(e,n),!(void 0!==a&&(t.exports=a))},function(t,e,i){var n,a;n=[i(3)],a=function(t){var e=t.React,i=t.ReactRender,n=t.MultiselectReact;return{createMultiselectComponent:function(t,a,s,o){for(var r,l=[],h=0;h<a.length;h++){var c={label:a[h],value:a[h]};l.push(e.createElement(n.Option,c,null))}return r=1==t.size&&""==Array.from(t)[0]?e.createElement(n,{allowNewValues:!0,onChange:o},l):e.createElement(n,{allowNewValues:!0,onChange:o,defaultValues:Array.from(t)},l),i(r,s)}}}.apply(e,n),!(void 0!==a&&(t.exports=a))},function(t,e,i){var n,a;n=[i(2),i(5),i(3),i(17),i(19),i(8)],a=function(t,e,i,n,a,s){var o=i.Modal,r='<a href="#" class="btn cancel-job pull-left">Cancel</a>',l='<a href="#" class="btn btn-primary ack-info pull-left">Acknowledge</a>',h='<a href="#" class="btn btn-primary modal-btn-primary pull-right">OK</a>',c='<a href="#" class="btn create-job pull-right">Create</a>',d=["create-alert","edit-alert","delete-alert","create-job","edit-job","delete-job","change-job-mode"];return o.extend({initialize:function(t){o.prototype.initialize.apply(this,arguments)},events:$.extend({},o.prototype.events,{"click .cancel-job":function(t){t.preventDefault(),this.hide()},"click .ack-info":function(t){t.preventDefault();var i=e.createService(),n=i.configurations({owner:"nobody",app:"splunk_app_aws"});n.fetch(function(t,e){var i=e.item("app");i.fetch(function(t,i){for(var n=i.properties(),a=0;a<n.entry.length;a++){var s=n.entry[a].name;"upgrade"==s&&e.post("app/upgrade",{status:1})}})}),this.hide()},"click a.create-alert":function(t){t.preventDefault(),this.hide(),this.trigger("createAlert",this.name)},"click a.edit-alert":function(t){t.preventDefault(),this.hide(),this.trigger("editAlert")},"click a.delete-alert":function(t){t.preventDefault(),this.hide(),this.trigger("deleteAlert",this.id,this.alert,!0)},"click a.delete-job":function(t){t.preventDefault(),this.hide(),this.trigger("deleteJob",this.id,this.alert)},"click a.edit-job":function(t){t.preventDefault(),this.hide(),this.trigger("editJob",this.name)},"click .create-job":function(t){t.preventDefault(),this.hide(),this.trigger("createJob")},"click .change-job-mode":function(t){t.preventDefault(),this.hide(),this.trigger("changeJobMode",this.id,this.mode)}}),render:function(){return this.$el.html(o.TEMPLATE),this.$(o.FOOTER_SELECTOR).append(r),this.$(o.FOOTER_SELECTOR).append(h),this.$(o.FOOTER_SELECTOR).append(c),this.$(".create-job").hide(),this},render_info_view:function(){return this.$el.html(o.TEMPLATE),this.$(o.FOOTER_SELECTOR).append(l).css("display","block"),this.$(".create-job").hide(),this},showFail:function(t,e){this._clean(),this.$(o.HEADER_TITLE_SELECTOR).html("Fail to "+e),this.$(".btn-primary").html("OK"),this.$(o.BODY_SELECTOR).html("Operations on "+t+" has been failed. Please try again."),this.show()},showAlertLoadFail:function(t){this._clean(),this.$(o.HEADER_TITLE_SELECTOR).html("Fail to load"),this.$(".btn-primary").html("Create"),this.$(".btn-primary").addClass("create-alert"),this.$(o.BODY_SELECTOR).html('Fail to load "'+t+"\" associate alert.<br>This is because alert's permission or accident deletion.\t            <br>Do you want to create another alert associate with current job ?"),this.name=t,this.show()},showJobSaveSuccess:function(t,e){this._clean();var i=(t&s.EDIT_MODE)>0?"updated":"saved",n=(e&s.EDIT_MODE)>0?"Edit Alert":"Create Alert";this.$(o.HEADER_TITLE_SELECTOR).html("Job has been "+i),this.$(".btn-primary").html(n);var a="";(e&s.EDIT_MODE)>0?(this.$(".btn-primary").addClass("edit-alert"),a+="You can continue to edit the binding alert.<br>"):(this.$(".btn-primary").addClass("create-alert"),a+="You can continue to create an alert associated with the job.<br>"),a+='If you want to receive customized email, please select action "Send email".',this.$(o.BODY_SELECTOR).html(a),this.show()},showJobDeleteConfirm:function(e,i,n){this._clean(),this.$(o.HEADER_TITLE_SELECTOR).html("Delete job"),this.$(".btn-primary").html("Delete"),this.$(".btn-primary").addClass("delete-job");var a="Are you sure you want to delete job ("+i+")";t.isEmpty(n)||(a+=" and corresponding alert ("+n.entry.get("name")+")"),a+=" ?",this.$(o.BODY_SELECTOR).html(a),this.id=e,this.alert=n,this.show()},showAlertDeleteConfirm:function(e,i,n){this._clean(),t.isEmpty(n)?this.showAlertLoadFail(i):(this.$(o.HEADER_TITLE_SELECTOR).html("Delete alert"),this.$(".btn-primary").html("Delete"),this.$(".btn-primary").addClass("delete-alert"),this.$(o.BODY_SELECTOR).html("Are you sure you want to delete alert ("+n.entry.get("name")+")?"),this.id=e,this.alert=n),this.show()},showJobModeChangeConfirm:function(t,e,i,n){this._clean(),this.$(o.HEADER_TITLE_SELECTOR).html(t+" job"),this.$(".btn-primary").html(t),this.$(".btn-primary").addClass("change-job-mode"),this.$(o.BODY_SELECTOR).html("Are you sure you want to "+t.toLowerCase()+" job("+i+") ?"),this.id=e,this.mode=n,this.show()},showJobEditConfirm:function(t){this._clean(),this.$(o.HEADER_TITLE_SELECTOR).html("Edit job"),this.$(".btn-primary").html("Edit"),this.$(".btn-primary").addClass("edit-job"),this.$(o.BODY_SELECTOR).html("Another job ("+t+") has been saved with same search. <br>Do you want to edit this job?"),this.name=t,this.show()},showUpgradeInfo:function(){this._clean(),this.$(o.HEADER_TITLE_SELECTOR).html("Information");var t=n.buildLinkNode(a.AWS_BEFORE_UPGRADE),e=n.buildLinkNode(a.AWS_AFTER_UPGRADE);this.$(o.BODY_SELECTOR).html("You installed the Splunk App for AWS version 6.0.3<br><br> Confirm you migrated the indexes for the app and disabled the required saved searches. "+t+"<br><br>Now, enable data model acceleration, schedule reports, and update the aws-data-model-acceleration search macro. "+e),this.show()},_clean:function(){this.$(".btn-primary").removeClass(d.join(" ")),this.$(".create-job").hide()}})}.apply(e,n),!(void 0!==a&&(t.exports=a))},function(t,e,i){var n,a;n=[i(2),i(18)],a=function(t,e){var i="splunk_app_aws",n="6.0.3",a=encodeURIComponent("["+i+":"+n+"]");return{buildLinkNode:function(t,i){return i=i||e.gettext("Learn more"),"<a class='external' target='_blank' href='/help?location="+a+t+"'>"+i+"</a>"}}}.apply(e,n),!(void 0!==a&&(t.exports=a))},function(t,e){"use strict";function i(){return o.apply(void 0,arguments)}function n(){return o.apply(void 0,arguments)}function a(t){o=t}function s(){a("undefined"!=typeof window&&window.gettext||function(t){return t})}Object.defineProperty(e,"__esModule",{value:!0}),e.gettext=i,e._=n,e.setSharedTranslator=a,e.resetSharedTranslator=s;var o;s()},function(t,e,i){var n;n=function(){return{AWS_RECOMMENDATION_DEPENDENCY:"aws.recommendation.dependency",AWS_DASHBOARD_SOURCETYPECHECKER:"aws.dashboard.sourcetypechecker",AWS_BILLING_TAGS:"aws.billing.tags",AWS_RECOMMENDATION_SECURITYGROUP:"aws.recommendation.securitygroup",AWS_RECOMMENDATION_ELB:"aws.recommendation.elb",AWS_RECOMMENDATION_EC2:"aws.recommendation.ec2",AWS_DASHBOARD_ACCOUNTNAME:"aws.dashboard.accountname",AWS_DASHBOARD_BILLINGDATAMODEL:"aws.dashboard.billingdatamodel",AWS_CUSTOM_INDEX:"aws.dashboard.customindex",AWS_DATA_FORWARDING:"aws.dashboard.dataforwarding",AWS_RI_PLANNER:"aws.dashboard.riplanner",AWS_RECOMMENDATION_EBS:"aws.dashboard.ebs",AWS_ANOMALY_DETECTION:"aws.dashboard.anomalydetection",AWS_BEFORE_UPGRADE:"beforeUpgrade",AWS_AFTER_UPGRADE:"afterUpgrade"}}.call(e,i,e,t),!(void 0!==n&&(t.exports=n))},function(t,e,i){var n,a;n=[i(2),i(13),i(3),i(8)],a=function(t,e,i,n){var a=i.splunkUtils,s=i.SharedModels,o=i.BaseView,r=i.ReportModel,l=i.ModAlertActionsCollection,h=i.CreateAlertView,c=i.EditAlertView;return o.extend({initialize:function(){this.models={},this.children={},this.collection={},this.models.user=s.get("user"),this.models.serverInfoModel=s.get("serverInfo"),this.models.application=s.get("app"),this.models.application.set("page","search"),this.collection.alertActionsCollection=new l,this.collection.alertActionsCollection.fetch({data:{app:this.models.application.get("app"),owner:this.models.application.get("owner"),search:"disabled!=1"},addListInTriggeredAlerts:!0})},showCreateAlert:function(t,e,i,s,o,l){var c=new r;c.fetch({data:{app:this.models.application.get("app"),owner:this.models.application.get("owner")},success:function(r,d){c.entry.content.set("search",'search index="'+n.INDEX+'" sourcetype="'+n.SOURCE_TYPE+'" '+n.JOB_ID+'="'+t+'" | eval total = 0 | foreach outlier_* [eval outlier_count_<<MATCHSTR>> = if(<<FIELD>>=="True", 1, 0) , total = total + outlier_count_<<MATCHSTR>>] | where total>0 | anomalytable | sort - Value | table _time, "Field name", Value, info_min_time, info_max_time'),this.children.alertDialog=new h({model:{report:c,application:this.models.application,user:this.models.user,serverInfo:this.models.serverInfoModel},onHiddenRemove:!0});var u="http://"+window.location.hostname+":"+window.location.port,p=["earliest=$result.info_min_time$","latest=$result.info_max_time$","display.general.type=visualizations","display.page.search.mode=smart","display.page.search.tab=visualizations","display.visualizations.type=custom","display.visualizations.custom.type=splunk_app_aws.anomaly_detection_viz","q="+encodeURIComponent(("|"===s.trimLeft().charAt(0)?"":"search ")+s)],m="### You can edit your own content here ###\n\nAnomaly detection job: "+e+"\nYou can view the detected results via link: "+u+a.make_full_url("app/splunk_app_aws/search?")+p.join("&"),_=this.children.alertDialog.model.alert;_.entry.content.set({"action.email.message.alert":m,"action.email.inline":!0});var f=_.cron;f.setDefaults=this.setDefaults.bind(f),
f.setDefaults();var E=this.setEarliestLatest.bind(_);E(),_.entry.content.on("change:dispatch.earliest_time",E),this.children.alertDialog.model.alert.entry.acl.set("can_share_app",!0),this.children.alertDialog.model.alert.on("saveSuccess",o.bind(l,this.children.alertDialog.model.alert)),this.children.alertDialog.render().appendTo($("body")).show(),f.set({cronType:i.toLowerCase()})}.bind(this)})},showEditAlert:function(t,e,i){this.children.alertDialog=new c({model:{alert:t,application:this.models.application,user:this.models.user,serverInfo:this.models.serverInfoModel},collection:{alertActions:this.collection.alertActionsCollection},onHiddenRemove:!0});var n=this.children.alertDialog.model.inmem;n.cron.setDefaults=this.setDefaults.bind(n.cron);var a=this.setEarliestLatest.bind(n);a(),n.entry.content.on("change:dispatch.earliest_time",a),n.on("sync",e.bind(i,t)),this.children.alertDialog.render().appendTo($("body")).show()},setDefaults:function(){switch(this.get("cronType")){case"hourly":this.set("minute","15");break;case"daily":this.set("hour","1");break;case"weekly":this.set({dayOfWeek:"1",hour:"2"});break;case"monthly":this.set({dayOfMonth:"1",hour:"3"})}},setEarliestLatest:function(){switch(this.cron.get("cronType")){case"hourly":this.entry.content.set({"dispatch.earliest_time":"-1h@h","dispatch.latest_time":"@h"},{silent:!0});break;case"daily":this.entry.content.set({"dispatch.earliest_time":"-1d@d","dispatch.latest_time":"@d"},{silent:!0});break;case"weekly":this.entry.content.set({"dispatch.earliest_time":"-1w@d","dispatch.latest_time":"@d"},{silent:!0});break;case"monthly":this.entry.content.set({"dispatch.earliest_time":"-1mon@d","dispatch.latest_time":"@d"},{silent:!0});break;default:return}}})}.apply(e,n),!(void 0!==a&&(t.exports=a))},function(t,e,i){var n,a;n=[i(1),i(2),i(13),i(5),i(8)],a=function(t,e,i,n,a){var s=n.createService({owner:"nobody",app:"splunk_app_aws"});return i.Model.extend({defaults:{success:!1,configs:{},tags:[],usedNames:[]},initialize:function(){i.Model.prototype.initialize.apply(this,arguments)},fetchData:function(){if(this.get("success"))return void this.trigger("loadSuccess");var t=s.request("configs/conf-anomalyconfigs","GET",{fillcontents:1});t.done(function(t){var i=JSON.parse(t),n={},s=[],o=[];e.each(i.entry,function(t){e.isEmpty(t.name)||(n[t.name]=t.content,n[t.name][a.JOB_ID]=t.name,a.JOB_TAGS in n[t.name]&&!e.isEmpty(n[t.name][a.JOB_TAGS])&&(s=e.union(s,n[t.name][a.JOB_TAGS].split(","))),a.JOB_NAME in n[t.name]&&!e.isEmpty(n[t.name][a.JOB_NAME])&&o.push(n[t.name][a.JOB_NAME]))}),s.sort(),this.set({configs:n,tags:s,success:!0,usedNames:o}),this.trigger("loadSuccess")}.bind(this)),t.fail(function(t,e,i){this.trigger("loadFail",i)}.bind(this))},getNameWithSearch:function(t){for(var e=this.get("configs"),i=Object.keys(e),n=0;n<i.length;n++){var s=e[i[n]];if(a.JOB_NAME in s&&a.JOB_SEARCH in s&&s[a.JOB_SEARCH]===t)return s[a.JOB_NAME]}return""},getJobWithName:function(t){for(var e=this.get("configs"),i=Object.keys(e),n=0;n<i.length;n++){var s=e[i[n]];if(a.JOB_NAME in s&&s[a.JOB_NAME]===t)return s}return null},createStanza:function(e){var i=this._generateUUID(),n=t.extend({name:i},e),a=s.request("configs/conf-anomalyconfigs","POST",null,n),o=t.Deferred();return a.done(function(t){this.set("success",!1),o.resolve(i)}.bind(this)),a.fail(function(t,e,i){o.reject()}.bind(this)),o.promise()},updateStanza:function(e,i){var n=s.request("configs/conf-anomalyconfigs/"+e,"POST",null,i),a=t.Deferred();return n.done(function(t){this.set("success",!1),a.resolve()}.bind(this)),n.fail(function(t,e,i){a.reject()}.bind(this)),a.promise()},deleteStanza:function(e){var i=s.request("configs/conf-anomalyconfigs/"+e,"DELETE"),n=t.Deferred();return i.done(function(t){n.resolve()}.bind(this)),i.fail(function(t,e,i){n.reject()}.bind(this)),n.promise()},_generateUUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0,i="x"==t?e:3&e|8;return i.toString(16)})}})}.apply(e,n),!(void 0!==a&&(t.exports=a))}])});