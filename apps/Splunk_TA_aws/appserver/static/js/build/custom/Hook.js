define(["jquery","underscore","moment"],function(e,t,s){return function(e){function t(i){if(s[i])return s[i].exports;var n=s[i]={exports:{},id:i,loaded:!1};return e[i].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var s={};return t.m=e,t.c=s,t.p="",t(0)}({0:function(e,t,s){function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n,r,o=function(){function e(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,s,i){return s&&e(t.prototype,s),i&&e(t,i),t}}();n=[s(1),s(3),s(4),s(5),s(38),s(39),s(40)],r=function(e,t,s,n,r,a){"use strict";var l=a("2038-01-19T03:14:07Z"),c={CloudTrail:"aws:cloudtrail",Config:"aws:config",S3AccessLogs:"aws:s3:accesslogs",CloudFrontAccessLogs:"aws:cloudfront:accesslogs",ELBAccessLogs:"aws:elb:accesslogs",CustomLogs:"aws:s3"},u=function(){function u(e,t,n,r){i(this,u),this.context=s.getComponent(e,t),this.model=n,this.serviceName=t,this.util=r,this._conflict_fields=JSON.parse(this.model.get("_conflict_fields")||"{}")}return o(u,[{key:"onCreate",value:function(){var e=this._getInputService(),s=e.input,i=e.service,r=n.map.find(function(e){return e.service===i&&e.input===s});if(r){var o=t.omit(r,["service","input"]);this.model.set(o)}if(Object.keys(this._conflict_fields).length>0&&this.model.set(this._conflict_fields,{unset:!0}),"aws_billing"===this.serviceName){if(t.isUndefined(this.model.get("initial_scan_datetime"))){var l=a().utc().subtract(3,"months").startOf("month");this.model.set("initial_scan_datetime",l.format("YYYY-MM-DDTHH:mm:ss")+"Z")}}else if("aws_billing_cur"===this.serviceName){if(t.isUndefined(this.model.get("start_date"))){var u=a().utc().subtract(3,"months").startOf("month");this.model.set("start_date",u.format("YYYY-MM"))}}else"aws_s3"===this.serviceName?t.isUndefined(this.model.get("initial_scan_datetime"))&&this.model.set("initial_scan_datetime",a().utc().format("YYYY-MM-DDTHH:mm:ss")+"Z"):"aws_sqs_based_s3"===this.serviceName&&(this.model.on("change:s3_file_decoder",function(){this.model.set("sourcetype",c[this.model.get("s3_file_decoder")])},this),t.isUndefined(this.model.get("sourcetype"))&&this.model.set("sourcetype",c[this.model.get("s3_file_decoder")]))}},{key:"onRender",value:function(){var t=this,s=this._getInputService(),i=s.input,n=s.service,o=e(".section-header > .section-label");if(o.length>0){var a=r.buildInputLink(n);e(o[0]).append(a)}if(Object.keys(this._conflict_fields).length>0){var l=this.context.entity,c="The following fields have conflict. ";c+=Object.keys(this._conflict_fields).map(function(e){t.util.addErrorToComponent(t.serviceName,e);var s=l.find(function(t){return t.field===e}).label;return s+" = ["+t._conflict_fields[e].join(", ")+"]"}).join(", "),c+=". Please resolve the conflict in conf file first.",this.util.displayErrorMsg(c)}"aws_s3"===this.serviceName?("aws_cloudtrail"!==i&&this._hideFields("ct_blacklist"),"others"!==i&&(this._hideFields(["whitelist","blacklist"]),this._disableFields("sourcetype"))):"splunk_ta_aws_logs"===this.serviceName?this._disableFields(["log_type","sourcetype"]):"aws_sqs_based_s3"===this.serviceName?"others"!==i&&this._disableFields(["s3_file_decoder","sourcetype"]):"aws_kinesis"===this.serviceName&&"vpc_flow_logs"===i&&this._disableFields(["format","encoding","sourcetype"])}},{key:"onSave",value:function(){if("splunk_ta_aws_logs"===this.serviceName){if("cloudfront:accesslogs"===this.model.get("log_type")&&!this.model.has("log_name_format"))return this.util.displayErrorMsg('Field "Distribution ID" is required.'),!1}else if("aws_cloudwatch"===this.serviceName){if(this.model.has("period")&&this.model.has("polling_interval")){var e=this.model.get("polling_interval")/this.model.get("period");if(Math.floor(e)!==e)return this.util.displayErrorMsg('The number of "Polling Interval" field should be a multiple of "Granularity".'),!1}}else if("aws_s3"===this.serviceName&&this.model.has("terminal_scan_datetime")){var t=this.model.get("terminal_scan_datetime");try{if(t=a(t),t>l)return this.util.displayErrorMsg("The max supported timestamp is 2038-01-19T03:14:07Z due to Year 2038 problem"),this.util.addErrorToComponent(this.serviceName,"terminal_scan_datetime"),!1;this.util.removeErrorMsg(),this.util.removeErrorFromComponent(this.serviceName,"terminal_scan_datetime")}catch(e){return!1}}return!0}},{key:"_getInputService",value:function(){this.urlParams=this._extractQuery();var e=this.urlParams,t=e.input,s=e.service;return t||(t=n.detectSource(this.model,this.serviceName)),{input:t,service:s}}},{key:"_extractQuery",value:function(){var e=document.location.search||document.location.hash;if(e&&0!==e.length){var t=e.indexOf("?")+1||0,s=e.substring(t).split("&"),i={};return s.forEach(function(e){var t=e.split("=");1===t.length?i[t[0]]=null:i[t[0]]=t[1]}),i}}},{key:"_disableFields",value:function(s){t.isArray(s)||(s=[s]);var i=!0,n=!1,r=void 0;try{for(var o,a=s[Symbol.iterator]();!(i=(o=a.next()).done);i=!0){var l=o.value;e('[data-name="'+l+'"]').find("input").prop("disabled",!0)}}catch(e){n=!0,r=e}finally{try{!i&&a.return&&a.return()}finally{if(n)throw r}}}},{key:"_hideFields",value:function(s){t.isArray(s)||(s=[s]);var i=!0,n=!1,r=void 0;try{for(var o,a=s[Symbol.iterator]();!(i=(o=a.next()).done);i=!0){var l=o.value;e('[data-name="'+l+'"]').parents(".form-horizontal."+l).hide()}}catch(e){n=!0,r=e}finally{try{!i&&a.return&&a.return()}finally{if(n)throw r}}}}]),u}();return u}.apply(t,n),!(void 0!==r&&(e.exports=r))},1:function(t,s){t.exports=e},3:function(e,s){e.exports=t},4:function(e,t,s){var i,n;i=[],n=function(){"use strict";return{getField:function(e,t,s){var i=this.getComponent(e,t).entity;return i.find(function(e){return e.field===s})},getComponent:function(e,t){var s=this.getServices(e),i=s.find(function(e){return e.name===t});return i},getServices:function(e){return e.pages.inputs.services}}}.apply(t,i),!(void 0!==n&&(e.exports=n))},5:function(e,t,s){var i,n;i=[s(3)],n=function(e){"use strict";return{mockService:{billing:"Billing",vpc_flow_logs:"VPC Flow Logs",s3_access_logs:"S3 Access Logs",cloudfront_access_logs:"Cloudfront Access Logs",elb_access_logs:"ELB Access Logs",others:"Custom Data Type"},map:[{service:"aws_kinesis",input:"vpc_flow_logs",format:"CloudWatchLogs",sourcetype:"aws:cloudwatchlogs:vpcflow"},{service:"aws_cloudwatch_logs",input:"vpc_flow_logs",sourcetype:"aws:cloudwatchlogs:vpcflow"},{service:"aws_s3",input:"aws_cloudtrail",sourcetype:"aws:cloudtrail"},{service:"aws_s3",input:"cloudfront_access_logs",sourcetype:"aws:cloudfront:accesslogs"},{service:"aws_s3",input:"elb_access_logs",sourcetype:"aws:elb:accesslogs"},{service:"aws_s3",input:"s3_access_logs",sourcetype:"aws:s3:accesslogs"},{service:"splunk_ta_aws_logs",input:"aws_cloudtrail",log_type:"cloudtrail"},{service:"splunk_ta_aws_logs",input:"cloudfront_access_logs",log_type:"cloudfront:accesslogs"},{service:"splunk_ta_aws_logs",input:"elb_access_logs",log_type:"elb:accesslogs"},{service:"splunk_ta_aws_logs",input:"s3_access_logs",log_type:"s3:accesslogs"},{service:"aws_sqs_based_s3",input:"aws_config",s3_file_decoder:"Config"},{service:"aws_sqs_based_s3",input:"aws_cloudtrail",s3_file_decoder:"CloudTrail"},{service:"aws_sqs_based_s3",input:"cloudfront_access_logs",s3_file_decoder:"CloudFrontAccessLogs"},{service:"aws_sqs_based_s3",input:"elb_access_logs",s3_file_decoder:"ELBAccessLogs"},{service:"aws_sqs_based_s3",input:"s3_access_logs",s3_file_decoder:"S3AccessLogs"},{service:"aws_sqs_based_s3",input:"others",s3_file_decoder:"CustomLogs"}],detectSource:function(t,s){var i=this.map.filter(function(e){return e.service===s}),n=i.find(function(s){s=e.omit(s,["service","input"]);var i=e.pick(t.attributes,Object.keys(s));return e.isEqual(s,i)});return n&&"input"in n?n.input:s}}}.apply(t,i),!(void 0!==n&&(e.exports=n))},8:function(e,t){e.exports=function(){var e=[];return e.toString=function(){for(var e=[],t=0;t<this.length;t++){var s=this[t];s[2]?e.push("@media "+s[2]+"{"+s[1]+"}"):e.push(s[1])}return e.join("")},e.i=function(t,s){"string"==typeof t&&(t=[[null,t,""]]);for(var i={},n=0;n<this.length;n++){var r=this[n][0];"number"==typeof r&&(i[r]=!0)}for(n=0;n<t.length;n++){var o=t[n];"number"==typeof o[0]&&i[o[0]]||(s&&!o[2]?o[2]=s:s&&(o[2]="("+o[2]+") and ("+s+")"),e.push(o))}},e}},9:function(e,t,s){function i(e,t){for(var s=0;s<e.length;s++){var i=e[s],n=_[i.id];if(n){n.refs++;for(var r=0;r<n.parts.length;r++)n.parts[r](i.parts[r]);for(;r<i.parts.length;r++)n.parts.push(c(i.parts[r],t))}else{for(var o=[],r=0;r<i.parts.length;r++)o.push(c(i.parts[r],t));_[i.id]={id:i.id,refs:1,parts:o}}}}function n(e){for(var t=[],s={},i=0;i<e.length;i++){var n=e[i],r=n[0],o=n[1],a=n[2],l=n[3],c={css:o,media:a,sourceMap:l};s[r]?s[r].parts.push(c):t.push(s[r]={id:r,parts:[c]})}return t}function r(e,t){var s=v(),i=w[w.length-1];if("top"===e.insertAt)i?i.nextSibling?s.insertBefore(t,i.nextSibling):s.appendChild(t):s.insertBefore(t,s.firstChild),w.push(t);else{if("bottom"!==e.insertAt)throw new Error("Invalid value for parameter 'insertAt'. Must be 'top' or 'bottom'.");s.appendChild(t)}}function o(e){e.parentNode.removeChild(e);var t=w.indexOf(e);t>=0&&w.splice(t,1)}function a(e){var t=document.createElement("style");return t.type="text/css",r(e,t),t}function l(e){var t=document.createElement("link");return t.rel="stylesheet",r(e,t),t}function c(e,t){var s,i,n;if(t.singleton){var r=m++;s=g||(g=a(t)),i=u.bind(null,s,r,!1),n=u.bind(null,s,r,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(s=l(t),i=f.bind(null,s),n=function(){o(s),s.href&&URL.revokeObjectURL(s.href)}):(s=a(t),i=d.bind(null,s),n=function(){o(s)});return i(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;i(e=t)}else n()}}function u(e,t,s,i){var n=s?"":i.css;if(e.styleSheet)e.styleSheet.cssText=y(t,n);else{var r=document.createTextNode(n),o=e.childNodes;o[t]&&e.removeChild(o[t]),o.length?e.insertBefore(r,o[t]):e.appendChild(r)}}function d(e,t){var s=t.css,i=t.media;if(i&&e.setAttribute("media",i),e.styleSheet)e.styleSheet.cssText=s;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(s))}}function f(e,t){var s=t.css,i=t.sourceMap;i&&(s+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(i))))+" */");var n=new Blob([s],{type:"text/css"}),r=e.href;e.href=URL.createObjectURL(n),r&&URL.revokeObjectURL(r)}var _={},p=function(e){var t;return function(){return"undefined"==typeof t&&(t=e.apply(this,arguments)),t}},h=p(function(){return/msie [6-9]\b/.test(window.navigator.userAgent.toLowerCase())}),v=p(function(){return document.head||document.getElementsByTagName("head")[0]}),g=null,m=0,w=[];e.exports=function(e,t){t=t||{},"undefined"==typeof t.singleton&&(t.singleton=h()),"undefined"==typeof t.insertAt&&(t.insertAt="bottom");var s=n(e);return i(s,t),function(e){for(var r=[],o=0;o<s.length;o++){var a=s[o],l=_[a.id];l.refs--,r.push(l)}if(e){var c=n(e);i(c,t)}for(var o=0;o<r.length;o++){var l=r[o];if(0===l.refs){for(var u=0;u<l.parts.length;u++)l.parts[u]();delete _[l.id]}}}};var y=function(){var e=[];return function(t,s){return e[t]=s,e.filter(Boolean).join("\n")}}()},38:function(e,t,s){var i,n;i=[s(3)],n=function(e){"use strict";var t={aws_description:"aws.description",aws_config:"aws.config",aws_config_rule:"aws.configrules",aws_cloudwatch:"aws.cloudwatch",aws_cloudwatch_logs:"aws.cloudwatchlogs",aws_s3:"aws.s3",splunk_ta_aws_logs:"aws.incrementals3",aws_sqs_based_s3:"aws.sqs_based_s3",aws_billing:"aws.billing",aws_billing_cur:"aws.billing.cur",aws_cloudtrail:"aws.cloudtrail",aws_kinesis:"aws.kinesis",aws_inspector:"aws.inspector",splunk_ta_aws_sqs:"aws.sqs"};return{buildLinkNode:function(t,s){return s=s||e("Learn more").t(),'<a class="external" target="_blank" href="/help?location='+encodeURIComponent("[AddOns:released]")+t+'">'+s+"</a>"},buildInputLink:function(e){return this.buildLinkNode(t[e])},ALL_LINKS:{SQS_BASED_S3:"aws.configure_aws.configure_sqs"}}}.apply(t,i),!(void 0!==n&&(e.exports=n))},39:function(e,t){e.exports=s},40:function(e,t,s){var i=s(41);"string"==typeof i&&(i=[[e.id,i,""]]);s(9)(i,{});i.locals&&(e.exports=i.locals)},41:function(e,t,s){t=e.exports=s(8)(),t.push([e.id,".section-label .external{font-size:10px}",""])}})});